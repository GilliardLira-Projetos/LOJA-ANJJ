<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LOJA ANJJ</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />

<style>
body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: #f6f6f6;
}

/* HEADER */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 32px;
  background: #1d4ed8;
  color: #fff;
  position: sticky;
  top: 0;
  z-index: 1000;
}
.logo { font-size: 22px; font-weight: 600; }

.cart-btn {
  background: #f59e0b;
  color: #fff;
  padding: 8px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  position: relative;
}
.cart-count {
  position: absolute;
  top: -6px;
  right: -6px;
  background: red;
  color: #fff;
  border-radius: 50%;
  font-size: 12px;
  padding: 2px 6px;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px,1fr));
  gap: 20px;
  padding: 20px;
}

/* CARD */
.card {
  background: #fff;
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,.12);
}

/* CARROSSEL */
.thumb-container {
  position: relative;
  height: 220px;
  overflow: hidden;
  border-radius: 10px;
}
.thumb-container img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: pointer;
}

.arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,.6);
  color: #fff;
  border: none;
  font-size: 20px;
  padding: 6px 10px;
  border-radius: 50%;
  cursor: pointer;
  z-index: 2;
}
.arrow.left { left: 8px; }
.arrow.right { right: 8px; }

.title { font-weight: 600; margin: 8px 0; }
.price { color: #1d4ed8; font-size: 18px; }

select, button {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button.add-cart {
  background: #1d4ed8;
  color: #fff;
  border: none;
}

/* MODAL */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.8);
  justify-content: center;
  align-items: center;
  z-index: 3000;
}
.modal.open { display: flex; }

.modal-content {
  position: relative;
  max-width: 90%;
  max-height: 80%;
}
.modal-content img {
  width: 100%;
  max-height: 80vh;
  object-fit: contain;
}
.modal-content button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,.6);
  color: #fff;
  border: none;
  font-size: 26px;
  padding: 10px;
  cursor: pointer;
}
.close-modal {
  top: 10px;
  right: 10px;
  transform: none;
}
.prev { left: -50px; }
.next { right: -50px; }

@media(max-width:768px){
  .prev { left: 10px; }
  .next { right: 10px; }
}
</style>
</head>

<body>

<header>
  <div class="logo">üèÜ LOJA ANJJ</div>
  <button class="cart-btn" onclick="toggleCart()">üõí Carrinho
    <span id="cartCount" class="cart-count">0</span>
  </button>
</header>

<section id="catalog" class="grid"></section>

<!-- MODAL -->
<div class="modal" id="imageModal">
  <div class="modal-content">
    <button class="close-modal" onclick="closeModal()">‚úñ</button>
    <button class="prev" onclick="changeImage(-1)">‚ùÆ</button>
    <img id="modalImage">
    <button class="next" onclick="changeImage(1)">‚ùØ</button>
  </div>
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/1BqVAf9A7l7KHKcwpV9HrqBMPWTA4s-aPv1EEna7xuHg/gviz/tq?tqx=out:json&sheet=Products";

let products = [];
let currentImages = [];
let currentIndex = 0;

function money(v){ return Number(v).toFixed(2).replace('.',','); }

async function fetchSheet(){
  const r = await fetch(SHEET_URL);
  const t = await r.text();
  const j = JSON.parse(t.substring(t.indexOf("{"), t.lastIndexOf("}")+1));
  const cols = j.table.cols.map(c=>c.label.toLowerCase());
  return j.table.rows.map(row=>{
    const o = {};
    row.c.forEach((c,i)=>o[cols[i]] = c ? c.v : "");
    return o;
  });
}

function groupProducts(data){
  const g = {};
  data.forEach(p=>{
    if(p.availability !== "show") return;
    if(!g[p.name]) g[p.name] = {name:p.name, images:[], variants:[]};
    g[p.name].variants.push({name:p["variant name"], price:+p.price});
    [p.thumbnail,p.image1,p.image2,p.image3].forEach(i=>{
      if(i && !g[p.name].images.includes(i)) g[p.name].images.push(i);
    });
  });
  return Object.values(g);
}

function createCard(p){
  let imgIndex = 0;

  const d = document.createElement("div");
  d.className = "card";

  d.innerHTML = `
    <div class="thumb-container">
      <button class="arrow left">‚ùÆ</button>
      <img src="${p.images[0]}">
      <button class="arrow right">‚ùØ</button>
    </div>
    <div class="title">${p.name}</div>
    <div class="price">R$ ${money(p.variants[0].price)}</div>
    <select>
      ${p.variants.map(v=>`<option>${v.name}</option>`).join("")}
    </select>
  `;

  const img = d.querySelector("img");

  d.querySelector(".left").onclick = ()=>{
    imgIndex = (imgIndex - 1 + p.images.length) % p.images.length;
    img.src = p.images[imgIndex];
  };

  d.querySelector(".right").onclick = ()=>{
    imgIndex = (imgIndex + 1) % p.images.length;
    img.src = p.images[imgIndex];
  };

  img.onclick = ()=>{
    openModal(p.images, imgIndex);
  };

  return d;
}

function openModal(images, index){
  currentImages = images;
  currentIndex = index;
  document.getElementById("modalImage").src = images[index];
  document.getElementById("imageModal").classList.add("open");
}

function closeModal(){
  document.getElementById("imageModal").classList.remove("open");
}

function changeImage(step){
  currentIndex = (currentIndex + step + currentImages.length) % currentImages.length;
  document.getElementById("modalImage").src = currentImages[currentIndex];
}

async function init(){
  const raw = await fetchSheet();
  products = groupProducts(raw);
  const grid = document.getElementById("catalog");
  products.forEach(p=>grid.appendChild(createCard(p)));
}

init();
</script>

</body>
</html>
