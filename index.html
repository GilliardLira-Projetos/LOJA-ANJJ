<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LOJA ANJJ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />

<style>
body{
  font-family:Poppins,sans-serif;
  margin:0;background:#f6f6f6;
}
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 32px;background:#1d4ed8;color:#fff;
  position:sticky;top:0;z-index:1000;
}
.logo{font-size:22px;font-weight:600}
.cart-btn{
  background:#f59e0b;color:#fff;padding:8px 12px;
  border:none;border-radius:6px;cursor:pointer;position:relative;
}
.cart-count{
  position:absolute;top:-6px;right:-6px;
  background:red;color:#fff;border-radius:50%;
  padding:2px 6px;font-size:12px;
}
.banner{height:260px;overflow:hidden}
.banner img{width:100%;height:100%;object-fit:cover}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:20px;padding:20px;
}
.card{
  background:#fff;border-radius:12px;padding:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}
.thumb-container{
  position:relative;
  height:220px;
  overflow:hidden;
  border-radius:10px;
  cursor:pointer;
}
.thumb-container img{
  width:100%;height:100%;object-fit:cover;
}
.arrow{
  position:absolute;top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,.6);
  color:#fff;border:none;
  font-size:20px;
  padding:6px 10px;
  cursor:pointer;border-radius:50%;
}
.arrow.left{left:8px}
.arrow.right{right:8px}

.title{font-weight:600;margin:10px 0}
.price{color:#1d4ed8;font-size:18px}

select,button{
  width:100%;padding:8px;
  border-radius:6px;border:1px solid #ccc;
}
button.add-cart{
  background:#1d4ed8;color:#fff;
  border:none;margin-top:8px;
}

.cart-overlay{
  position:fixed;top:0;right:0;
  width:100%;max-width:420px;height:100%;
  background:#fff;box-shadow:-4px 0 20px rgba(0,0,0,.2);
  padding:20px;transform:translateX(100%);
  transition:.3s;z-index:2000;
}
.cart-overlay.open{transform:translateX(0)}

.modal{
  display:none;position:fixed;
  inset:0;background:rgba(0,0,0,.85);
  justify-content:center;align-items:center;
  z-index:3000;
}
.modal.open{display:flex}
.modal img{
  max-width:90%;max-height:90%;
  border-radius:10px;
}
.modal button{
  position:absolute;top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,.6);
  color:#fff;border:none;
  font-size:28px;padding:10px;
  cursor:pointer;border-radius:50%;
}
.modal .close{top:20px;right:20px;transform:none}
.modal .prev{left:30px}
.modal .next{right:30px}
</style>
</head>

<body>

<header>
  <div class="logo">üèÜ LOJA ANJJ</div>
  <button class="cart-btn" onclick="toggleCart()">üõí Carrinho <span id="cartCount" class="cart-count">0</span></button>
</header>

<section class="banner">
  <img src="Image/jiujitsu.jpg">
</section>

<section id="catalog" class="grid"></section>

<!-- Carrinho -->
<div class="cart-overlay" id="cartOverlay">
  <h3>üõçÔ∏è Carrinho</h3>
  <div id="cartItems"></div>
  <p><strong>Total: R$ <span id="cartTotal">0,00</span></strong></p>
  <button onclick="toggleCart()">Fechar</button>
</div>

<!-- Modal -->
<div id="imageModal" class="modal">
  <button class="close" onclick="closeModal()">‚úñ</button>
  <button class="prev" onclick="changeModalImage(-1)">‚óÄ</button>
  <img id="modalImage">
  <button class="next" onclick="changeModalImage(1)">‚ñ∂</button>
</div>

<script>
const SHEET_URL="https://docs.google.com/spreadsheets/d/1BqVAf9A7l7KHKcwpV9HrqBMPWTA4s-aPv1EEna7xuHg/gviz/tq?tqx=out:json&sheet=Products";

let products=[],cart=[];
let modalImages=[],modalIndex=0;

function money(v){return Number(v).toFixed(2).replace('.',',');}

async function fetchSheet(){
  const r=await fetch(SHEET_URL);
  const t=await r.text();
  const j=JSON.parse(t.substring(t.indexOf("{"),t.lastIndexOf("}")+1));
  const cols=j.table.cols.map(c=>c.label.toLowerCase());
  return j.table.rows.map(row=>{
    const o={};row.c.forEach((c,i)=>o[cols[i]]=c?c.v:"");return o;
  });
}

function groupProducts(data){
  const g={};
  data.forEach(p=>{
    if(p.availability!=="show")return;
    if(!g[p.name])g[p.name]={name:p.name,variants:[],images:[],imgIndex:0};
    g[p.name].variants.push({name:p["variant name"],price:+p.price,stock:+p.stock});
    [p.thumbnail,p.image1,p.image2].forEach(i=>i&&g[p.name].images.push(i));
  });
  return Object.values(g);
}

function createCard(p){
  const d=document.createElement("div");
  d.className="card";

  d.innerHTML=`
  <div class="thumb-container">
    <button class="arrow left">‚óÄ</button>
    <img src="${p.images[0]}">
    <button class="arrow right">‚ñ∂</button>
  </div>
  <div class="title">${p.name}</div>
  <div class="price">R$ ${money(p.variants[0].price)}</div>

  <select class="variant">
    <option disabled selected>Selecione o tamanho</option>
    ${p.variants.map(v=>`<option value="${v.price}" data-stock="${v.stock}">${v.name}</option>`).join("")}
  </select>

  <select class="qty"></select>
  <button class="add-cart">Adicionar ao Carrinho</button>
  `;

  const img=d.querySelector("img");
  const left=d.querySelector(".left");
  const right=d.querySelector(".right");

  left.onclick=()=>{p.imgIndex=(p.imgIndex-1+p.images.length)%p.images.length;img.src=p.images[p.imgIndex];}
  right.onclick=()=>{p.imgIndex=(p.imgIndex+1)%p.images.length;img.src=p.images[p.imgIndex];}
  img.onclick=()=>openModal(p.images,p.imgIndex);

  return d;
}

function openModal(imgs,i){
  modalImages=imgs;modalIndex=i;
  document.getElementById("modalImage").src=modalImages[modalIndex];
  document.getElementById("imageModal").classList.add("open");
}
function closeModal(){document.getElementById("imageModal").classList.remove("open");}
function changeModalImage(d){
  modalIndex=(modalIndex+d+modalImages.length)%modalImages.length;
  document.getElementById("modalImage").src=modalImages[modalIndex];
}

function toggleCart(){document.getElementById("cartOverlay").classList.toggle("open");}

async function init(){
  const raw=await fetchSheet();
  products=groupProducts(raw);
  const grid=document.getElementById("catalog");
  products.forEach(p=>grid.appendChild(createCard(p)));
}
init();
</script>

</body>
</html>
